appId: keepass2android.keepass2android_nonet
---
# Test: KeeShare Edit Password Functionality
# Tests the ability to edit an existing KeeShare configuration to update the password.
#
# Prerequisites:
#   - Database already open with a KeeShare group configured
#   - keeshare-test-export.kdbx password: share123
#
# This is a utility flow - typically run after keeshare_import_flow.yaml
# Run with: maestro test e2e-tests/.maestro/keeshare_edit_password.yaml

- launchApp

# Wait for app - should show database or unlock screen
- extendedWaitUntil:
    visible: ".*Unlock.*|.*Root.*|.*Sample.*"
    timeout: 10000

# If locked, unlock with test password
- runFlow:
    when:
      visible: "Unlock"
    commands:
      - tapOn:
          text: "Password"
          optional: true
      - inputText: "test123"
      - hideKeyboard
      - tapOn: "Unlock"
      - extendedWaitUntil:
          visible: ".*Root.*|.*Sample.*"
          timeout: 15000

# Dismiss dialogs
- tapOn:
    text: "OK"
    optional: true

# Navigate to KeeShare settings
- tapOn:
    id: ".*overflow.*|.*more.*"
    optional: true
- tapOn:
    text: "More options"
    optional: true
- tapOn: "Settings"

- extendedWaitUntil:
    visible: "Database"
    timeout: 5000
- tapOn: "Database"

- scrollUntilVisible:
    element: "Configure KeeShare groups"
    direction: DOWN
    timeout: 10000
- tapOn:
    text: "Configure KeeShare groups"

# Wait for KeeShare screen
- extendedWaitUntil:
    visible: ".*KeeShare.*|.*Edit.*"
    timeout: 5000

# Verify Edit button is visible
- assertVisible:
    text: "Edit"

# Tap Edit on the first KeeShare group
- tapOn:
    text: "Edit"

# Wait for edit dialog
- extendedWaitUntil:
    visible: ".*Edit KeeShare.*|.*Password.*"
    timeout: 5000

# Verify dialog components are present
- assertVisible:
    text: ".*Share Type.*|.*Import.*|.*Export.*|.*Synchronize.*"

# Clear and enter a new password
- tapOn:
    id: ".*edit_password.*"
- clearText
- inputText: "share123"
- hideKeyboard

# Save changes
- tapOn:
    text: "OK"

# Wait for save to complete
- extendedWaitUntil:
    visible: ".*Password.*configured.*|.*Sync now.*"
    timeout: 5000

# Verify password status shows configured
- assertVisible:
    text: ".*Password.*configured.*"

# Test the sync works with the new password
- tapOn:
    text: "Sync now"

# Wait for sync result
- extendedWaitUntil:
    visible: ".*sync.*|.*KeeShare.*"
    timeout: 15000

# Test passed - edit functionality works
